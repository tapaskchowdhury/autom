# Features

### Current features

 Generate csr file.

### Upcoming features
 - Generate .pfx. 
 - Store .csr files in keepaas (or a similar tool). 
 - Send email on key, .csr and .pfx generation. 
 - Create CRQ. 


## Generate csr file
Alternatively a .csr file can be simplly generated by running the above steps in a local docker container. For this way of .csr generation please see steps below. 


### Running docker container

### Pull the docker image locally
This step only pulls the docker image locally. (Once pulled you need the run the container separately):

`docker pull tchowdhury/my_csr_gen`

### Running container
This command looks for the image *tchowdhury/my_csr_gen* locally and if not found pulls the image from dockerhub and runs it:

`docker run --rm -v $(pwd):/app -ti -e "GIT_BRANCH=<branch>" -e "CSR_INFO_FILE=<csr_info_filename>" tchowdhury/my_csr_gen`

Parameters expected by the command are:

 - GIT_BRANCH

 - CSR\_INFO_FILE

##### List of variables and corresponding values to be used
    <csr_info_filename>=single_cn, single_cn, multiple_cn, multiple_cn
    <branch>=master

These values are passed on the scripts that are executed inside the container. 

example:

`docker run --rm -v $(pwd):/app -ti -e "GIT_BRANCH=master" -e "CSR_INFO_FILE=single_cn" tchowdhury/my_csr_gen`

##### Passphrase for .key and .csr generation 
Passphrase is required for creation of .key and .csr files. Passphrase is prompted to be asked thrice and the same passphrase is expected each time. 

##### Running scripts inside the container:

`bash csr-init.sh <branch> <csr_info_filename>`

example:

`bash csr-init.sh master single_cn`

### For troubleshooting container

`docker run --rm -v $(pwd):/app -ti -e "GIT_BRANCH=<branch>" -e "CSR_INFO_FILE=<csr_info_filename>" tchowdhury/my_csr_gen bash`

providing *bash* at the end of the command starts the container and prvovides you with a bash shell running inside the container. 

### Ouput
On successful execution of container, the .key and .csr files are copied locally. 

The files are available here:

    $(pwd)/csr/my.key
    $(pwd)/csr/my.csr

where $(pwd) is the folder from where docker command was triggered. 


### Testing a new image
Unless you are updating code and wish to test the changes, *master* branch should be used. If not then create a new branch from *master* (say: AKA-4104) and make relevant changes. To test the code changes from a branch other than*master*, following parameters need to be updated

#### Code changes for creating image from a different branch 
1. Update the following argument in Dockerfile
`ARG GIT_URL=<URL>`

2. Use $GIT_URL=*branch-name-used-in-above-step* when using the *docker run* command to run container. Value of $GIT_URL is used for calling *csr-init.sh* script. 
